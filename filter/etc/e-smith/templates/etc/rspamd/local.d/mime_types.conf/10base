{
#
# block attachment following file extensions
#
return unless ($rspamd{BlockAttachmentStatus} eq 'enabled');


# Known classes:
my %extClasses = (
'Exec' => [qw(exe exe-ms vbe vbs wsc wsf wsh msc msi msp mst pif scr sct bat cmd com cpl dll jse inf js jar)],
'Arch' => [qw(zip 7z rar tar gz cab bz2)],
);

if(defined $rspamd{BlockAttachmentClassList}) {
    foreach $class (split(',', ($rspamd{BlockAttachmentClassList}))) {
        if(($class eq 'Exec') && defined $extClasses{'Exec'}) {
            push @banned_extensions, @{$extClasses{'Exec'}};
        }
        if(($class eq 'Arch') && defined $extClasses{'Arch'}) {
            push @banned_archives, @{$extClasses{'Arch'}};
        }
    }
}

# Custom list:
if($rspamd{BlockAttachmentCustomStatus} eq 'enabled'
    && defined $rspamd{BlockAttachmentCustomList}) {
    foreach $extension (split(',', ($rspamd{BlockAttachmentCustomList}))) {
        # trim whitespace:
        $extension =~ s/\s+//;
        push @banned_extensions, $extension;
    }
}

if (@banned_extensions) {
    # Here we reject with a 1 multiplicator the bad extensions and archives
    # a force action will reject and add the smtp message rejection

    # meta array, we don't want to push arch extension to bad_archive_extensions
    push @banned_extensionsArchives,(@banned_extensions,@banned_archives);

    $OUT .= q(
# Extensions and archives that are treated as 'bad'
# Number is score multiply factor
bad_extensions = {
);
    foreach $lines (@banned_extensionsArchives){
        $OUT .= "$lines = 1,\n";
    }

    $OUT .='};'."\n";
    $OUT.= q(
# Extensions that cannot be inside archives
bad_archive_extensions = {
);
    foreach $lines (@banned_extensions){
        $OUT .= "$lines = 1,\n";
    }

    $OUT .='};'."\n";
}

# return empty if arrays undefined
'';
}
